<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤©çœ‹ä»€ä¹ˆç”µå½±ï¼Ÿ</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sec: #a0a0a0;
            --accent: #e50914; /* Netflix Red */
            --accent-hover: #b20710;
            --highlight: #ffd700;
            --tag-bg: #333;
            --tag-active: #e50914;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
        }

        a { text-decoration: none; color: inherit; }

        /* Header */
        header {
            background-color: #000;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        h1 { margin: 0; font-size: 1.5rem; }
        p.subtitle { color: var(--text-sec); font-size: 0.9rem; margin-top: 5px; }

        /* Filter Section */
        .filter-container {
            background-color: #181818;
            padding: 20px;
            border-bottom: 1px solid #333;
        }

        .filter-group {
            margin-bottom: 15px;
            display: flex;
            align-items: baseline;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-label {
            font-weight: bold;
            color: var(--highlight);
            min-width: 60px;
            font-size: 0.9rem;
        }

        /* Checkbox Styling (Hidden checkbox, styled label) */
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            flex: 1;
        }

        .check-btn {
            display: none; /* Hide actual checkbox */
        }

        .check-label {
            padding: 6px 12px;
            background-color: var(--tag-bg);
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            user-select: none;
        }

        .check-label:hover { background-color: #444; }

        /* Checked State */
        .check-btn:checked + .check-label {
            background-color: var(--tag-active);
            color: white;
            border-color: var(--tag-active);
            font-weight: bold;
        }

        /* MBTI Logic Note */
        .logic-note {
            font-size: 0.75rem;
            color: #666;
            margin-left: 10px;
        }

        /* Action Buttons */
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }

        button {
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }

        button.btn-random {
            background-color: var(--highlight);
            color: #000;
            font-weight: bold;
        }
        button.btn-random:hover { transform: scale(1.05); background-color: #ffe033; }

        button.btn-reset {
            background-color: transparent;
            border: 1px solid #666;
            color: var(--text-sec);
        }
        button.btn-reset:hover { border-color: #aaa; color: #fff; }

        /* Movie Grid & Card (Same as before) */
        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .movie-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            border-color: #555;
            box-shadow: 0 8px 12px rgba(0,0,0,0.5);
        }

        .card-header {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .movie-title-link {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            transition: color 0.2s;
            border-bottom: 1px solid transparent;
        }
        .movie-title-link:hover { color: var(--highlight); border-bottom: 1px solid var(--highlight); }

        .movie-year { font-size: 0.9rem; color: var(--highlight); font-weight: bold; white-space: nowrap; margin-left: 10px; }

        .card-body { padding: 15px; flex-grow: 1; }

        .meta-tag {
            display: inline-block;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            background-color: #333;
            color: #ccc;
        }
        .tag-region { background-color: #1f4068; color: #a6c1ee; }
        .tag-mbti { background-color: #4a1c40; color: #eeb8dd; border: 1px solid #752a65; }

        .info-row { margin-bottom: 8px; font-size: 0.9rem; color: var(--text-sec); }
        .desc {
            font-size: 0.9rem;
            line-height: 1.4;
            color: #ddd;
            margin-top: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #222;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 2px solid var(--highlight);
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-emoji { font-size: 4rem; margin-bottom: 10px; display: block; }
        .modal-title-link { font-size: 1.8rem; margin-bottom: 10px; color: var(--highlight); display: inline-block; border-bottom: 1px solid transparent; }
        .modal-title-link:hover { border-bottom: 1px solid var(--highlight); opacity: 0.8; }
        .modal-info { margin-bottom: 20px; font-size: 1.1rem; color: var(--text-sec); }
        .modal-mbti { margin-top: 15px; font-weight: bold; color: var(--accent); }
        .modal-actions { display: flex; gap: 15px; margin-top: 25px; justify-content: center; }
        .btn-modal-action { flex: 1; padding: 12px; border-radius: 8px; font-weight: bold; border:none; }
        .btn-change { background-color: #333; color: white; border: 1px solid #555; }
        .btn-confirm { background-color: var(--accent); color: white; }

        .status-bar { text-align: center; padding: 10px; color: var(--text-sec); font-size: 0.9rem; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¬ ä»Šå¤©çœ‹ä»€ä¹ˆç”µå½±ï¼Ÿ</h1>
    <p class="subtitle">@ian233</p>
</header>

<div class="filter-container">
    <div class="filter-group">
        <span class="filter-label">åœ°åŒº:</span>
        <div class="filter-options">
            <input type="checkbox" id="reg1" name="region" value="å¤§é™†" class="check-btn" onchange="applyFilters()">
            <label for="reg1" class="check-label">ğŸ‡¨ğŸ‡³ å¤§é™†</label>
            
            <input type="checkbox" id="reg2" name="region" value="é¦™æ¸¯" class="check-btn" onchange="applyFilters()">
            <label for="reg2" class="check-label">ğŸ‡­ğŸ‡° é¦™æ¸¯</label>
            
            <input type="checkbox" id="reg3" name="region" value="å°æ¹¾" class="check-btn" onchange="applyFilters()">
            <label for="reg3" class="check-label">ğŸ‡¹ğŸ‡¼ å°æ¹¾</label>
            
            <input type="checkbox" id="reg4" name="region" value="æ¬§ç¾" class="check-btn" onchange="applyFilters()">
            <label for="reg4" class="check-label">ğŸ‡ºğŸ‡¸ æ¬§ç¾</label>
            
            <input type="checkbox" id="reg5" name="region" value="å…¶ä»–" class="check-btn" onchange="applyFilters()">
            <label for="reg5" class="check-label">ğŸ‡¯ğŸ‡µ å…¶ä»–</label>
        </div>
    </div>

    <div class="filter-group">
        <span class="filter-label">ç±»åˆ«:</span>
        <div class="filter-options">
            <input type="checkbox" id="cat1" name="genre" value="å‰§æƒ…" class="check-btn" onchange="applyFilters()">
            <label for="cat1" class="check-label">å‰§æƒ…</label>
            
            <input type="checkbox" id="cat2" name="genre" value="å–œå‰§" class="check-btn" onchange="applyFilters()">
            <label for="cat2" class="check-label">å–œå‰§</label>
            
            <input type="checkbox" id="cat3" name="genre" value="åŠ¨ä½œ" class="check-btn" onchange="applyFilters()">
            <label for="cat3" class="check-label">åŠ¨ä½œ/æ­¦ä¾ </label>
            
            <input type="checkbox" id="cat4" name="genre" value="ç§‘å¹»" class="check-btn" onchange="applyFilters()">
            <label for="cat4" class="check-label">ç§‘å¹»</label>
            
            <input type="checkbox" id="cat5" name="genre" value="æ‚¬ç–‘" class="check-btn" onchange="applyFilters()">
            <label for="cat5" class="check-label">æ‚¬ç–‘/çŠ¯ç½ª</label>
            
            <input type="checkbox" id="cat6" name="genre" value="çˆ±æƒ…" class="check-btn" onchange="applyFilters()">
            <label for="cat6" class="check-label">çˆ±æƒ…</label>
            
            <input type="checkbox" id="cat7" name="genre" value="åŠ¨ç”»" class="check-btn" onchange="applyFilters()">
            <label for="cat7" class="check-label">åŠ¨ç”»</label>
            
            <input type="checkbox" id="cat8" name="genre" value="æƒŠæ‚š" class="check-btn" onchange="applyFilters()">
            <label for="cat8" class="check-label">æƒŠæ‚š/ææ€–</label>
        </div>
    </div>

    <div class="filter-group">
        <span class="filter-label">å¹´ä»½:</span>
        <div class="filter-options">
            <input type="checkbox" id="year1" name="year" value="2020-2025" class="check-btn" onchange="applyFilters()">
            <label for="year1" class="check-label">2020s</label>
            
            <input type="checkbox" id="year2" name="year" value="2010-2019" class="check-btn" onchange="applyFilters()">
            <label for="year2" class="check-label">2010s</label>
            
            <input type="checkbox" id="year3" name="year" value="2000-2009" class="check-btn" onchange="applyFilters()">
            <label for="year3" class="check-label">2000s</label>
            
            <input type="checkbox" id="year4" name="year" value="1990-1999" class="check-btn" onchange="applyFilters()">
            <label for="year4" class="check-label">1990s</label>
            
            <input type="checkbox" id="year5" name="year" value="pre-1990" class="check-btn" onchange="applyFilters()">
            <label for="year5" class="check-label">ç»å…¸è€ç‰‡</label>
        </div>
    </div>

    <div class="filter-group">
        <span class="filter-label">
            MBTI:<br>
            <span style="font-size:0.7em; color:#666; font-weight:normal;">(äº¤é›†)</span>
        </span>
        <div class="filter-options">
            <input type="checkbox" id="m1" name="mbti" value="INTJ" class="check-btn" onchange="applyFilters()">
            <label for="m1" class="check-label">INTJ</label>
            <input type="checkbox" id="m2" name="mbti" value="INTP" class="check-btn" onchange="applyFilters()">
            <label for="m2" class="check-label">INTP</label>
            <input type="checkbox" id="m3" name="mbti" value="ENTJ" class="check-btn" onchange="applyFilters()">
            <label for="m3" class="check-label">ENTJ</label>
            <input type="checkbox" id="m4" name="mbti" value="ENTP" class="check-btn" onchange="applyFilters()">
            <label for="m4" class="check-label">ENTP</label>
            
            <input type="checkbox" id="m5" name="mbti" value="INFJ" class="check-btn" onchange="applyFilters()">
            <label for="m5" class="check-label">INFJ</label>
            <input type="checkbox" id="m6" name="mbti" value="INFP" class="check-btn" onchange="applyFilters()">
            <label for="m6" class="check-label">INFP</label>
            <input type="checkbox" id="m7" name="mbti" value="ENFJ" class="check-btn" onchange="applyFilters()">
            <label for="m7" class="check-label">ENFJ</label>
            <input type="checkbox" id="m8" name="mbti" value="ENFP" class="check-btn" onchange="applyFilters()">
            <label for="m8" class="check-label">ENFP</label>
            
            <input type="checkbox" id="m9" name="mbti" value="ISTJ" class="check-btn" onchange="applyFilters()">
            <label for="m9" class="check-label">ISTJ</label>
            <input type="checkbox" id="m10" name="mbti" value="ISFJ" class="check-btn" onchange="applyFilters()">
            <label for="m10" class="check-label">ISFJ</label>
            <input type="checkbox" id="m11" name="mbti" value="ESTJ" class="check-btn" onchange="applyFilters()">
            <label for="m11" class="check-label">ESTJ</label>
            <input type="checkbox" id="m12" name="mbti" value="ESFJ" class="check-btn" onchange="applyFilters()">
            <label for="m12" class="check-label">ESFJ</label>
            
            <input type="checkbox" id="m13" name="mbti" value="ISTP" class="check-btn" onchange="applyFilters()">
            <label for="m13" class="check-label">ISTP</label>
            <input type="checkbox" id="m14" name="mbti" value="ISFP" class="check-btn" onchange="applyFilters()">
            <label for="m14" class="check-label">ISFP</label>
            <input type="checkbox" id="m15" name="mbti" value="ESTP" class="check-btn" onchange="applyFilters()">
            <label for="m15" class="check-label">ESTP</label>
            <input type="checkbox" id="m16" name="mbti" value="ESFP" class="check-btn" onchange="applyFilters()">
            <label for="m16" class="check-label">ESFP</label>
        </div>
    </div>

    <div class="action-bar">
        <button class="btn-reset" onclick="resetFilters()">â†º é‡ç½®æ‰€æœ‰æ¡ä»¶</button>
        <button class="btn-random" onclick="helpMeChoose()">ğŸ² å¸®æˆ‘é€‰ä¸€éƒ¨ï¼</button>
    </div>
</div>

<div class="status-bar" id="statusBar">åŠ è½½ä¸­...</div>

<div class="movie-grid" id="movieGrid"></div>

<div class="modal-overlay" id="modal">
    <div class="modal-content">
        <span class="modal-emoji" id="modalIcon">ğŸ¿</span>
        <h3 style="color:#888; margin-bottom: 5px;">æ¨èæ‚¨ä»Šæ™šè§‚çœ‹ï¼š</h3>
        <div id="modalTitleContainer"></div>
        <div class="modal-info" id="modalMeta">å¹´ä»½ | å¯¼æ¼”</div>
        <p class="desc" id="modalDesc">ç®€ä»‹...</p>
        <div class="modal-mbti" id="modalMbti">æ¨èç»™: INTJ</div>
        <div class="modal-actions">
            <button class="btn-modal-action btn-change" onclick="helpMeChoose(true)">ğŸ”„ ä¸å–œæ¬¢ï¼Ÿæ¢ä¸€éƒ¨</button>
            <button id="btnGoWatch" class="btn-modal-action btn-confirm">ğŸ‘Œ å¥½çš„ï¼Œæˆ‘å»çœ‹çœ‹</button>
        </div>
    </div>
</div>

<script src="movies.js"></script>

<script>
    let currentList = [];

    window.onload = () => {
        if (typeof allMovies !== 'undefined') {
            currentList = [...allMovies];
            applyFilters();
        } else {
            document.getElementById('statusBar').innerText = "é”™è¯¯ï¼šæ— æ³•åŠ è½½ movies.js æ•°æ®æ–‡ä»¶ã€‚";
        }
    };

    // è·å–æŸä¸€ç»„å¤šé€‰æ¡†é€‰ä¸­çš„å€¼
    function getSelectedValues(name) {
        const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
        return Array.from(checkboxes).map(cb => cb.value);
    }

    function applyFilters() {
        const selectedRegions = getSelectedValues('region');
        const selectedGenres = getSelectedValues('genre');
        const selectedYears = getSelectedValues('year');
        const selectedMbtis = getSelectedValues('mbti');

        if (typeof allMovies === 'undefined') return;

        currentList = allMovies.filter(movie => {
            const mRegion = movie["åœ°åŒº"] || "";
            const mCategory = movie["ç±»åˆ«"] || "";
            const mYear = parseInt(movie["å¹´ä»½"]);
            const mMbti = movie["æ¨èäººç¾¤ (MBTI)"] || "";

            // 1. åœ°åŒº (å¹¶é›† OR): å¦‚æœæ²¡é€‰ï¼Œé»˜è®¤å…¨åŒ¹é…ï¼›å¦‚æœé€‰äº†ï¼Œç”µå½±å¿…é¡»åŒ…å«å…¶ä¸­è‡³å°‘ä¸€ä¸ª
            let regionMatch = true;
            if (selectedRegions.length > 0) {
                regionMatch = selectedRegions.some(region => {
                    if (region === 'å…¶ä»–') {
                        const mainRegions = ['å¤§é™†', 'é¦™æ¸¯', 'å°æ¹¾', 'æ¬§ç¾'];
                        const isMain = mainRegions.some(r => mRegion.includes(r));
                        return !isMain || mRegion.includes('å…¶ä»–') || mRegion.includes('æ—¥æœ¬') || mRegion.includes('éŸ©å›½');
                    }
                    return mRegion.includes(region);
                });
            }

            // 2. ç±»åˆ« (å¹¶é›† OR)
            let genreMatch = true;
            if (selectedGenres.length > 0) {
                genreMatch = selectedGenres.some(genre => mCategory.includes(genre));
            }

            // 3. å¹´ä»½ (å¹¶é›† OR)
            let yearMatch = true;
            if (selectedYears.length > 0) {
                yearMatch = selectedYears.some(range => {
                    if (range === 'pre-1990') return mYear < 1990;
                    if (range === '1990-1999') return mYear >= 1990 && mYear <= 1999;
                    if (range === '2000-2009') return mYear >= 2000 && mYear <= 2009;
                    if (range === '2010-2019') return mYear >= 2010 && mYear <= 2019;
                    if (range === '2020-2025') return mYear >= 2020;
                    return false;
                });
            }

            // 4. MBTI (äº¤é›† AND): å¿…é¡»åŒ…å«æ‰€æœ‰é€‰ä¸­çš„äººæ ¼
            // å¦‚æœæ²¡é€‰ï¼Œè¿”å› trueï¼›å¦‚æœé€‰äº†ï¼Œå¿…é¡»æ¯ä¸€ä¸ªé€‰ä¸­çš„ MBTI éƒ½åœ¨ç”µå½±çš„æ ‡ç­¾é‡Œ
            let mbtiMatch = true;
            if (selectedMbtis.length > 0) {
                mbtiMatch = selectedMbtis.every(mbti => mMbti.includes(mbti));
            }

            return regionMatch && genreMatch && yearMatch && mbtiMatch;
        });

        document.getElementById('statusBar').innerText = `å½“å‰ç­›é€‰ç»“æœï¼š${currentList.length} éƒ¨ç”µå½±`;
        renderMovies(currentList);
    }

    function renderMovies(list) {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = "";

        if (list.length === 0) {
            grid.innerHTML = `
                <div style='width:100%; text-align:center; color:#666; margin-top:50px;'>
                    <p style="font-size:1.2rem;">ğŸ™…â€â™‚ï¸ æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç”µå½±</p>
                    <p>MBTI æ˜¯"äº¤é›†"ç­›é€‰ï¼Œè¯·å°è¯•å‡å°‘ MBTI é€‰é¡¹ï¼Œ<br>æˆ–è€…å¢åŠ åœ°åŒº/ç±»åˆ«çš„é€‰é¡¹ã€‚</p>
                </div>`;
            return;
        }

        list.forEach(movie => {
            const card = document.createElement('div');
            card.className = 'movie-card';
            
            const mbtiStr = movie["æ¨èäººç¾¤ (MBTI)"] || "";
            const mbtiBadges = mbtiStr.split(/,|ã€/).map(s => s.trim()).filter(s=>s).map(type => `<span class="meta-tag tag-mbti">${type}</span>`).join('');
            
            const icon = movie["å›¾æ ‡"] || "ğŸ¬";
            const movieName = movie["ç”µå½±åç§°"];
            const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(movieName + ' ç”µå½±')}`;

            card.innerHTML = `
                <div class="card-header">
                    <a href="${googleSearchUrl}" target="_blank" class="movie-title-link" title="ç‚¹å‡»æœç´¢: ${movieName}">
                        ${icon} ${movieName}
                    </a>
                    <span class="movie-year">${movie["å¹´ä»½"]}</span>
                </div>
                <div class="card-body">
                    <div style="margin-bottom:8px;">
                        <span class="meta-tag tag-region">${movie["åœ°åŒº"]}</span>
                        <span class="meta-tag" style="background:#333;">${movie["ç±»åˆ«"].split('/')[0]}</span>
                    </div>
                    <div class="info-row"><strong>å¯¼æ¼”:</strong> ${movie["å¯¼æ¼”"]}</div>
                    <div class="info-row"><strong>ä¸»æ¼”:</strong> ${movie["ä¸»æ¼”"]}</div>
                    <p class="desc">${movie["ç®€ä»‹"]}</p>
                    <div style="margin-top:10px;">${mbtiBadges}</div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function resetFilters() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        applyFilters();
    }

    function helpMeChoose(isRetry = false) {
        if (currentList.length === 0) {
            alert("å½“å‰ç»“æœä¸ºç©ºï¼Œè¯·è°ƒæ•´ç­›é€‰æ¡ä»¶ï¼");
            return;
        }
        
        const randomIndex = Math.floor(Math.random() * currentList.length);
        const choice = currentList[randomIndex];
        const icon = choice["å›¾æ ‡"] || "ğŸ¬";
        const movieName = choice["ç”µå½±åç§°"];
        const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(movieName + ' ç”µå½±')}`;

        document.getElementById('modalIcon').innerText = icon;
        document.getElementById('modalTitleContainer').innerHTML = `
            <a href="${googleSearchUrl}" target="_blank" class="modal-title-link" title="ç‚¹å‡»æœç´¢">
                ${movieName}
            </a>
        `;
        document.getElementById('modalMeta').innerText = `${choice["å¹´ä»½"]} | ${choice["åœ°åŒº"]} | ${choice["å¯¼æ¼”"]}`;
        document.getElementById('modalDesc').innerText = choice["ç®€ä»‹"];
        document.getElementById('modalMbti').innerText = `æ¨èç»™: ${choice["æ¨èäººç¾¤ (MBTI)"]}`;

        const goWatchBtn = document.getElementById('btnGoWatch');
        if (goWatchBtn) {
            goWatchBtn.onclick = function() {
                window.open(googleSearchUrl, '_blank');
                closeModal();
            };
        }

        if (!isRetry) {
            document.getElementById('modal').style.display = 'flex';
        }
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }
    
    window.onclick = function(event) {
        const modal = document.getElementById('modal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>
