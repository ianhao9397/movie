<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>400éƒ¨å½±å²ç»å…¸ & MBTI é€‰ç‰‡æŒ‡å—</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sec: #a0a0a0;
            --accent: #e50914; /* Netflix Red */
            --accent-hover: #b20710;
            --highlight: #ffd700;
            --btn-sec: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
        }

        a { text-decoration: none; color: inherit; }

        /* Header */
        header {
            background-color: #000;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        h1 { margin: 0; font-size: 1.5rem; }
        p.subtitle { color: var(--text-sec); font-size: 0.9rem; margin-top: 5px; }

        /* Controls */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background-color: #181818;
            border-bottom: 1px solid #333;
        }

        select, button {
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #2b2b2b;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        select:hover { background-color: #333; }

        button.btn-random {
            background-color: var(--accent);
            border-color: var(--accent);
            font-weight: bold;
            box-shadow: 0 0 10px rgba(229, 9, 20, 0.4);
        }
        
        button.btn-random:hover {
            background-color: var(--accent-hover);
            transform: scale(1.05);
        }

        button.btn-reset {
            background-color: transparent;
            border: 1px solid #666;
        }
        button.btn-reset:hover { background-color: #333; }

        /* Movie Grid */
        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Movie Card */
        .movie-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            border-color: #555;
            box-shadow: 0 8px 12px rgba(0,0,0,0.5);
        }

        .card-header {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ç”µå½±æ ‡é¢˜é“¾æ¥æ ·å¼ */
        .movie-title-link {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            transition: color 0.2s;
            border-bottom: 1px solid transparent;
        }
        
        .movie-title-link:hover {
            color: var(--highlight);
            border-bottom: 1px solid var(--highlight);
        }

        .movie-year {
            font-size: 0.9rem;
            color: var(--highlight);
            font-weight: bold;
            white-space: nowrap;
            margin-left: 10px;
        }

        .card-body {
            padding: 15px;
            flex-grow: 1;
        }

        .meta-tag {
            display: inline-block;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
            margin-bottom: 5px;
            background-color: #333;
            color: #ccc;
        }

        .tag-region { background-color: #1f4068; color: #a6c1ee; }
        .tag-mbti { background-color: #4a1c40; color: #eeb8dd; border: 1px solid #752a65; }

        .info-row { margin-bottom: 8px; font-size: 0.9rem; color: var(--text-sec); }
        .info-row strong { color: #ccc; }

        .desc {
            font-size: 0.9rem;
            line-height: 1.4;
            color: #ddd;
            margin-top: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Modal (Random Pick) */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #222;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 2px solid var(--accent);
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-emoji { font-size: 4rem; margin-bottom: 10px; display: block; }
        
        .modal-title-link { 
            font-size: 1.8rem; 
            margin-bottom: 10px; 
            color: var(--accent); 
            display: inline-block;
            border-bottom: 1px solid transparent;
        }
        .modal-title-link:hover {
            border-bottom: 1px solid var(--accent);
            opacity: 0.8;
        }

        .modal-info { margin-bottom: 20px; font-size: 1.1rem; color: var(--text-sec); }
        .modal-mbti { margin-top: 15px; font-weight: bold; color: var(--highlight); }

        /* Modal Buttons */
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
        }

        .btn-modal-action {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-change {
            background-color: var(--btn-sec);
            color: white;
            border: 1px solid #555;
        }
        .btn-change:hover { background-color: #444; }

        .btn-confirm {
            background-color: var(--accent);
            color: white;
        }
        .btn-confirm:hover { background-color: var(--accent-hover); }

        .status-bar {
            text-align: center;
            padding: 10px;
            color: var(--text-sec);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<header>
    <h1>ğŸ¬ ä»Šå¤©çœ‹ä»€ä¹ˆç”µå½± </h1>
    <p class="subtitle">@ian233</p>
</header>

<div class="controls">
    <select id="regionFilter" onchange="applyFilters()">
        <option value="all">ğŸŒ æ‰€æœ‰åœ°åŒº</option>
        <option value="å¤§é™†">ğŸ‡¨ğŸ‡³ ä¸­å›½å¤§é™†</option>
        <option value="é¦™æ¸¯">ğŸ‡­ğŸ‡° ä¸­å›½é¦™æ¸¯</option>
        <option value="å°æ¹¾">ğŸ‡¹ğŸ‡¼ ä¸­å›½å°æ¹¾</option>
        <option value="æ¬§ç¾">ğŸ‡ºğŸ‡¸/ğŸ‡ªğŸ‡º æ¬§ç¾</option>
        <option value="å…¶ä»–">ğŸ‡¯ğŸ‡µ/ğŸ‡°ğŸ‡· å…¶ä»–(æ—¥éŸ©ç­‰)</option>
    </select>

    <select id="genreFilter" onchange="applyFilters()">
        <option value="all">ğŸ­ æ‰€æœ‰ç±»åˆ«</option>
        <option value="å‰§æƒ…">å‰§æƒ…</option>
        <option value="å–œå‰§">å–œå‰§</option>
        <option value="åŠ¨ä½œ">åŠ¨ä½œ/æ­¦ä¾ </option>
        <option value="ç§‘å¹»">ç§‘å¹»</option>
        <option value="æ‚¬ç–‘">æ‚¬ç–‘/çŠ¯ç½ª</option>
        <option value="çˆ±æƒ…">çˆ±æƒ…</option>
        <option value="åŠ¨ç”»">åŠ¨ç”»</option>
        <option value="æˆ˜äº‰">æˆ˜äº‰</option>
        <option value="æƒŠæ‚š">æƒŠæ‚š/ææ€–</option>
    </select>

    <select id="yearFilter" onchange="applyFilters()">
        <option value="all">ğŸ“… æ‰€æœ‰å¹´ä»½</option>
        <option value="2020-2025">2020 - 2025 (è¿‘æœŸ)</option>
        <option value="2010-2019">2010 - 2019</option>
        <option value="2000-2009">2000 - 2009</option>
        <option value="1990-1999">1990 - 1999 </option>
        <option value="pre-1990">1990 ä»¥å‰</option>
    </select>

    <select id="mbtiFilter" onchange="applyFilters()">
        <option value="all">ğŸ§  æ‰€æœ‰æ€§æ ¼ (MBTI)</option>
        <optgroup label="åˆ†æå®¶ (NT)">
            <option value="INTJ">INTJ (å»ºç­‘å¸ˆ)</option>
            <option value="INTP">INTP (é€»è¾‘å­¦å®¶)</option>
            <option value="ENTJ">ENTJ (æŒ‡æŒ¥å®˜)</option>
            <option value="ENTP">ENTP (è¾©è®ºå®¶)</option>
        </optgroup>
        <optgroup label="å¤–äº¤å®¶ (NF)">
            <option value="INFJ">INFJ (æå€¡è€…)</option>
            <option value="INFP">INFP (è°ƒåœè€…)</option>
            <option value="ENFJ">ENFJ (ä¸»äººå…¬)</option>
            <option value="ENFP">ENFP (ç«é€‰è€…)</option>
        </optgroup>
        <optgroup label="å®ˆæŠ¤è€… (SJ)">
            <option value="ISTJ">ISTJ (ç‰©æµå¸ˆ)</option>
            <option value="ISFJ">ISFJ (å®ˆå«è€…)</option>
            <option value="ESTJ">ESTJ (æ€»ç»ç†)</option>
            <option value="ESFJ">ESFJ (æ‰§æ”¿å®˜)</option>
        </optgroup>
        <optgroup label="æ¢é™©å®¶ (SP)">
            <option value="ISTP">ISTP (é‰´èµå®¶)</option>
            <option value="ISFP">ISFP (æ¢é™©å®¶)</option>
            <option value="ESTP">ESTP (ä¼ä¸šå®¶)</option>
            <option value="ESFP">ESFP (è¡¨æ¼”è€…)</option>
        </optgroup>
    </select>

    <button class="btn-reset" onclick="resetFilters()">â†º é‡ç½®</button>
    <button class="btn-random" onclick="helpMeChoose()">ğŸ² å¸®æˆ‘é€‰ä¸€éƒ¨ï¼</button>
</div>

<div class="status-bar" id="statusBar">åŠ è½½ä¸­...</div>

<div class="movie-grid" id="movieGrid"></div>

<div class="modal-overlay" id="modal">
    <div class="modal-content">
        <span class="modal-emoji" id="modalIcon">ğŸ¿</span>
        
        <h3 style="color:#888; margin-bottom: 5px;">æ¨èæ‚¨ä»Šæ™šè§‚çœ‹ï¼š</h3>
        
        <div id="modalTitleContainer"></div>

        <div class="modal-info" id="modalMeta">å¹´ä»½ | å¯¼æ¼”</div>
        <p class="desc" id="modalDesc">ç®€ä»‹...</p>
        <div class="modal-mbti" id="modalMbti">æ¨èç»™: INTJ</div>
        
        <div class="modal-actions">
            <button class="btn-modal-action btn-change" onclick="helpMeChoose(true)">ğŸ”„ ä¸å–œæ¬¢ï¼Ÿæ¢ä¸€éƒ¨</button>
            <button class="btn-modal-action btn-confirm" onclick="closeModal()">ğŸ‘Œ å¥½çš„ï¼Œæˆ‘å»çœ‹çœ‹</button>
        </div>
    </div>
</div>

<script src="movies.js"></script>

<script>
    let currentList = [];

    // åˆå§‹åŒ–
    window.onload = () => {
        if (typeof allMovies !== 'undefined') {
            currentList = [...allMovies];
            applyFilters();
        } else {
            document.getElementById('statusBar').innerText = "é”™è¯¯ï¼šæ— æ³•åŠ è½½ movies.js æ•°æ®æ–‡ä»¶ã€‚";
        }
    };

    function applyFilters() {
        const region = document.getElementById('regionFilter').value;
        const genre = document.getElementById('genreFilter').value;
        const yearRange = document.getElementById('yearFilter').value;
        const mbti = document.getElementById('mbtiFilter').value;

        if (typeof allMovies === 'undefined') return;

        currentList = allMovies.filter(movie => {
            const mRegion = movie["åœ°åŒº"] || "";
            const mCategory = movie["ç±»åˆ«"] || "";
            const mYear = parseInt(movie["å¹´ä»½"]);
            const mMbti = movie["æ¨èäººç¾¤ (MBTI)"] || "";

            let regionMatch = (region === 'all') ? true : mRegion.includes(region);
            if (region === 'å…¶ä»–') {
                const mainRegions = ['å¤§é™†', 'é¦™æ¸¯', 'å°æ¹¾', 'æ¬§ç¾'];
                regionMatch = !mainRegions.some(r => mRegion.includes(r));
                if (mRegion.includes('å…¶ä»–') || mRegion.includes('æ—¥æœ¬') || mRegion.includes('éŸ©å›½') || mRegion.includes('å°åº¦')) regionMatch = true;
            }

            const genreMatch = (genre === 'all') ? true : mCategory.includes(genre);
            const mbtiMatch = (mbti === 'all') ? true : mMbti.includes(mbti);

            let yearMatch = true;
            if (yearRange !== 'all') {
                if (yearRange === 'pre-1990') yearMatch = mYear < 1990;
                else if (yearRange === '1990-1999') yearMatch = mYear >= 1990 && mYear <= 1999;
                else if (yearRange === '2000-2009') yearMatch = mYear >= 2000 && mYear <= 2009;
                else if (yearRange === '2010-2019') yearMatch = mYear >= 2010 && mYear <= 2019;
                else if (yearRange === '2020-2025') yearMatch = mYear >= 2020;
            }

            return regionMatch && genreMatch && yearMatch && mbtiMatch;
        });

        document.getElementById('statusBar').innerText = `å½“å‰ç­›é€‰ç»“æœï¼š${currentList.length} éƒ¨ç”µå½±`;
        renderMovies(currentList);
    }

    function renderMovies(list) {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = "";

        if (list.length === 0) {
            grid.innerHTML = "<p style='width:100%; text-align:center; color:#666; margin-top:50px;'>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç”µå½±ï¼Œè¯·å°è¯•æ”¾å®½ç­›é€‰æ¡ä»¶ã€‚</p>";
            return;
        }

        list.forEach(movie => {
            const card = document.createElement('div');
            card.className = 'movie-card';
            
            const mbtiStr = movie["æ¨èäººç¾¤ (MBTI)"] || "";
            const mbtiBadges = mbtiStr.split(/,|ã€/).map(s => s.trim()).filter(s=>s).map(type => `<span class="meta-tag tag-mbti">${type}</span>`).join('');
            
            const icon = movie["å›¾æ ‡"] || "ğŸ¬";
            const movieName = movie["ç”µå½±åç§°"];
            const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(movieName + ' ç”µå½±')}`;

            card.innerHTML = `
                <div class="card-header">
                    <a href="${googleSearchUrl}" target="_blank" class="movie-title-link" title="ç‚¹å‡»æœç´¢: ${movieName}">
                        ${icon} ${movieName}
                    </a>
                    <span class="movie-year">${movie["å¹´ä»½"]}</span>
                </div>
                <div class="card-body">
                    <div style="margin-bottom:8px;">
                        <span class="meta-tag tag-region">${movie["åœ°åŒº"]}</span>
                        <span class="meta-tag" style="background:#333;">${movie["ç±»åˆ«"].split('/')[0]}</span>
                    </div>
                    <div class="info-row"><strong>å¯¼æ¼”:</strong> ${movie["å¯¼æ¼”"]}</div>
                    <div class="info-row"><strong>ä¸»æ¼”:</strong> ${movie["ä¸»æ¼”"]}</div>
                    <p class="desc">${movie["ç®€ä»‹"]}</p>
                    <div style="margin-top:10px;">${mbtiBadges}</div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function resetFilters() {
        document.getElementById('regionFilter').value = 'all';
        document.getElementById('genreFilter').value = 'all';
        document.getElementById('yearFilter').value = 'all';
        document.getElementById('mbtiFilter').value = 'all';
        applyFilters();
    }

    // isRetry = true è¡¨ç¤ºç‚¹å‡»äº†â€œæ¢ä¸€éƒ¨â€
    function helpMeChoose(isRetry = false) {
        if (currentList.length === 0) {
            alert("å½“å‰æ²¡æœ‰ç”µå½±å¯é€‰ï¼Œè¯·é‡ç½®ç­›é€‰æ¡ä»¶ï¼");
            return;
        }
        
        const randomIndex = Math.floor(Math.random() * currentList.length);
        const choice = currentList[randomIndex];
        const icon = choice["å›¾æ ‡"] || "ğŸ¬";
        const movieName = choice["ç”µå½±åç§°"];
        const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(movieName + ' ç”µå½±')}`;

        // æ›´æ–°å¼¹çª—å†…å®¹
        document.getElementById('modalIcon').innerText = icon;
        
        // æ¸²æŸ“å¯ç‚¹å‡»çš„æ ‡é¢˜
        const titleContainer = document.getElementById('modalTitleContainer');
        titleContainer.innerHTML = `
            <a href="${googleSearchUrl}" target="_blank" class="modal-title-link" title="ç‚¹å‡»æœç´¢">
                ${movieName}
            </a>
        `;

        document.getElementById('modalMeta').innerText = `${choice["å¹´ä»½"]} | ${choice["åœ°åŒº"]} | ${choice["å¯¼æ¼”"]}`;
        document.getElementById('modalDesc').innerText = choice["ç®€ä»‹"];
        document.getElementById('modalMbti').innerText = `æ¨èç»™: ${choice["æ¨èäººç¾¤ (MBTI)"]}`;

        // æ˜¾ç¤º Modal
        if (!isRetry) {
            const modal = document.getElementById('modal');
            modal.style.display = 'flex';
        }
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }
    
    window.onclick = function(event) {
        const modal = document.getElementById('modal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

</body>
</html>
